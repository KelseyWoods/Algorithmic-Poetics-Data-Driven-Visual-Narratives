<div id="commuter-current-container" style="width:100vw; height:60vh; background:#111; position:relative; margin-bottom:1em;">
  <canvas id="commuter-current-canvas" style="width:100%; height:100%; display:block;"></canvas>
</div>
<script>
// --- Configurable Data for Demo (replace with live data if available) ---
const ROUTES = [
  { points: [ {x:0.1, y:0.2}, {x:0.5, y:0.3}, {x:0.8, y:0.5} ], baseFreq: 0.8, color: 'orange' },
  { points: [ {x:0.2, y:0.7}, {x:0.5, y:0.3}, {x:0.7, y:0.1} ], baseFreq: 0.6, color: 'cyan' },
  { points: [ {x:0.3, y:0.8}, {x:0.5, y:0.6}, {x:0.5, y:0.3} ], baseFreq: 0.4, color: 'magenta' },
];
const HUBS = [
  { x: 0.5, y: 0.3 },
  { x: 0.5, y: 0.6 },
];
function getPalette(hour) {
  if (hour >= 6 && hour < 10) {
    return { bg: "#211006", lineGlow: "rgba(255, 200, 0, 0.5)", colors: ["#FFC300", "#FFD700", "#FFA500"], hub: "#fff" };
  } else if (hour >= 10 && hour < 16) {
    return { bg: "#0e1932", lineGlow: "rgba(0, 200, 255, 0.3)", colors: ["#6EC6FF", "#00C853", "#80D8FF"], hub: "#b0f0ff" };
  } else if (hour >= 16 && hour < 20) {
    return { bg: "#2a0a2e", lineGlow: "rgba(200, 0, 255, 0.3)", colors: ["#B71C1C", "#9C27B0", "#F50057"], hub: "#fff2" };
  } else {
    return { bg: "#0a0c1a", lineGlow: "rgba(100, 150, 255, 0.2)", colors: ["#90caf9", "#bdbdbd", "#9fa8da"], hub: "#aaa" };
  }
}
function lerp(a, b, t) { return a + (b - a) * t; }
const container = document.getElementById('commuter-current-container');
const canvas = document.getElementById('commuter-current-canvas');
const ctx = canvas.getContext('2d');
function resize() {
  canvas.width = container.offsetWidth;
  canvas.height = container.offsetHeight;
}
window.addEventListener('resize', resize);
resize();
function animate() {
  const now = new Date();
  const hour = now.getHours();
  const palette = getPalette(hour);
  ctx.globalAlpha = 1;
  ctx.fillStyle = palette.bg;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ROUTES.forEach((route, idx) => {
    let t = (hour < 12) ? Math.abs(8 - hour) : Math.abs(17 - hour);
    let act = Math.max(0, 1 - t/4) * 1.3 + Math.random()*0.1;
    act = Math.max(act, 0.2);
    let thickness = lerp(2, 18, act * route.baseFreq);
    let speed = lerp(0.2, 2.0, act);
    let color = palette.colors[idx % palette.colors.length];
    ctx.save();
    ctx.shadowBlur = thickness*2;
    ctx.shadowColor = palette.lineGlow;
    ctx.lineCap = "round";
    ctx.lineJoin = "round";
    ctx.globalAlpha = lerp(0.3, 1, act);
    ctx.beginPath();
    const pts = route.points.map(p => ({
      x: p.x * canvas.width,
      y: p.y * canvas.height
    }));
    ctx.moveTo(pts[0].x, pts[0].y);
    for (let i=1; i<pts.length; i++) ctx.lineTo(pts[i].x, pts[i].y);
    let dashOffset = (performance.now() * speed/40) % 40;
    ctx.setLineDash([40, 60]);
    ctx.lineDashOffset = -dashOffset;
    ctx.strokeStyle = color;
    ctx.lineWidth = thickness;
    ctx.stroke();
    ctx.restore();
  });
  HUBS.forEach(hub => {
    const x = hub.x * canvas.width, y = hub.y * canvas.height;
    ctx.save();
    let act = 0;
    ROUTES.forEach(route => {
      if (route.points.some(p=>Math.abs(p.x-hub.x)<0.02 && Math.abs(p.y-hub.y)<0.02)) {
        let t = (hour < 12) ? Math.abs(8 - hour) : Math.abs(17 - hour);
        act += Math.max(0, 1 - t/4) * route.baseFreq;
      }
    });
    act = Math.min(act, 1.5);
    let pulse = Math.abs(Math.sin(performance.now()/500 + x + y));
    let r = lerp(10, 70, act) + pulse*10;
    ctx.globalAlpha = 0.7;
    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI*2, false);
    ctx.fillStyle = palette.hub;
    ctx.shadowBlur = r*1.2;
    ctx.shadowColor = "#fff";
    ctx.fill();
    ctx.restore();
  });
  requestAnimationFrame(animate);
}
animate();
</script>